<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Virtual - Ziloy</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="index-page">
    <header>
        <div class="header-container">
            <h1 class="logo-text"><a href="{{ url_for('index') }}">Ziloy</a></h1>
            <nav>
                <ul class="nav-list">
                    <li><a href="{{ url_for('tienda_virtual') }}">Tienda Virtual</a></li>
                    <li><a href="#" id="ziloyBotLink">Ziloy Bot</a></li>
                    <li><a href="{{ url_for('conocenos') }}">Sobre Nosotros</a></li>
                </ul>
            </nav>
            {% if 'user_id' in session %}
            <a href="{{ url_for('logout') }}" class="btn-login">Cerrar Sesión</a>
            {% else %}
            <a href="{{ url_for('login') }}" class="btn-login">Iniciar Sesión</a>
            {% endif %}
        </div>
    </header>

    <section class="cta-section text-center py-5">
            <main class="text-center py-1">
                <h2 class="mb-4" style="color:#ffffff;">Bienvenido a tu Tienda Virtual</h2>
                <p class="lead" style="max-width: 800px; margin: auto;">
                    Explora nuestra tienda virtual y descubre productos innovadores diseñados para
                    mejorar tu día a día. Calidad, sostenibilidad y tecnología al alcance de tu mano.
                </p>
            </main>
    </section>

    <!-- === SECCIÓN TIENDA VIRTUAL === -->
    <section class="how-it-works">
        <section class="store-section py-5">
            <div class="container d-flex flex-column flex-md-row align-items-center justify-content-center gap-5">

                <!-- IMAGEN DEL PRODUCTO -->
                <div class="product-image text-center">
                    <img id="productImage" src="{{ url_for('static', filename='images/ziloy_negro.png') }}"
                        alt="Bolsa Térmica Ziloy" class="img-fluid rounded shadow" style="max-width: 320px;">
                    <div class="color-buttons d-flex justify-content-center gap-3 mt-3">
                        <button class="color-btn" id="blackBtn" style="background-color: black;"></button>
                        <button class="color-btn" id="pinkBtn" style="background-color: pink;"></button>
                    </div>
                </div>

                <!-- DETALLES DEL PRODUCTO -->
                <div class="product-details text-center text-md-start">
                    <h2 class="fw-bold" style="color:#00c9a7;">Bolsa Térmica Ziloy</h2>
                    <p class="mb-5">Mantén tus bebidas a la temperatura perfecta, con estilo y tecnología inteligente.
                    </p>

                    <div
                        class="price-box d-flex align-items-center justify-content-center justify-content-md-start gap-3 mt-3">
                        <span id="price" class="price fw-bold fs-4" style="color:#00c9a7;">USD $18</span>

                        <div class="quantity-box d-flex align-items-center border rounded px-2">
                            <button class="btn-qty" id="decreaseBtn">-</button>
                            <input type="text" id="quantity" value="1" class="text-center border-0" style="width: 40px;"
                                readonly>
                            <button class="btn-qty" id="increaseBtn">+</button>
                        </div>
                    </div>

                    <button class="btn mt-4 px-4 py-2 fw-bold text-light"
                        style="background-color:#00c9a7; border-radius:30px;">Comprar
                    </button>

                    <div id="colorDescriptionCard" class="color-card mt-4 p-3 rounded shadow-sm">
                    </div>

                </div>
            </div>
        </section>
    </section>

    <!-- === MODAL DE CONFIRMACIÓN DE COMPRA === -->
    <div id="purchaseOverlay" class="overlay hidden">
        <div class="purchase-card">
            <h3>¿Deseas confirmar tu compra de la Bolsa Térmica Ziloy?</h3>
            <p class="text-muted" style="color: #ffffff !important;">
                El proceso de compra se realizará automáticamente en tu WhatsApp.<br>
                {% if 'user_id' not in session %}
                ⚠️ Debes iniciar sesión antes de continuar, necesitamos tu número de teléfono.
                {% endif %}
            </p>

            <div class="purchase-buttons">
                {% if 'user_id' in session %}
                <button id="confirmPurchase" class="btn btn-success px-4">Confirmar</button>
                {% else %}
                <a href="{{ url_for('login') }}" class="btn btn-success px-4">Iniciar Sesión</a>
                {% endif %}
                <button id="cancelPurchase" class="btn btn-danger px-4">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="container-fluid py-5 text-white" style="background-color: #00c9a7;">
        <div class="container">
            <div class="row text-center">

                <div class="col-lg-4 col-md-6 mb-4">
                    <i class="fas fa-truck fa-3x mb-3" style="color: #000;"></i> <h5 class="fw-bold mb-3" style="color: #ffffff;">Opciones de Envío en Ecuador</h5>
                    <ul class="list-unstyled small text-dark mx-auto" style="max-width: 500px; text-align: center;">
                        <li>Servientrega: Cobertura Nacional</li>
                        <li>Correos del Ecuador: Económico</li>
                        <li>Urbano: Entrega Rápida en Ciudades</li>
                    </ul>
                </div>

                <div class="col-lg-4 col-md-6 mb-4">
                    <i class="fas fa-microchip fa-3x mb-3" style="color: #000;"></i> <h5 class="fw-bold mb-3" style="color: #ffffff;">Tecnología Digital Integrada</h5>
                    <p class="small text-dark">
                        Nuestra bolsa incorpora sensores digitales y sistemas inteligentes para asegurar que 
                        tus bebidas mantengan la temperatura exacta por más tiempo, según lo documentado en nuestro proyecto de desarrollo.
                    </p>
                </div>

                <div class="col-lg-4 col-md-6 mb-4">
                    <i class="fas fa-leaf fa-3x mb-3" style="color: #000;"></i> <h5 class="fw-bold mb-3" style="color: #ffffff;">Compromiso Sostenible</h5>
                    <p class="small text-dark">
                        Ziloy promueve la Eco-Innovación y el uso de materiales duraderos, alineándose 
                        con prácticas responsables que minimizan el impacto ambiental y fomentan un consumo consciente.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 - Ziloy | UCundinamarca y UNL</p>
    </footer>



    <!--CHATBOT FLOTANTE-->
    <div id="chatbotPopup" class="chatbot-popup" style="display:none;">
        <div class="chatbot-header">
            <span>Ziloy Bot</span>
            <button id="closeChatbot" class="chatbot-close">&times;</button>
        </div>
        <div class="chatbot-body">
            <div id="chatMessages"></div>
            <div style="display:flex; gap:8px;">
                <input id="chatInput" type="text" placeholder="Escribe un mensaje..." />
                <button id="sendMessage">Enviar</button>
            </div>
        </div>
    </div>

    <!-- CAMBIO DE COLOR DEL PRODUCTO -->
    <script>
        const productImage = document.getElementById("productImage");
        const blackBtn = document.getElementById("blackBtn");
        const pinkBtn = document.getElementById("pinkBtn");
        const descriptionCard = document.getElementById("colorDescriptionCard"); 

        const descriptions = {
            'black': {
                title: 'Edición Elegancia Profesional',
                text: 'El color negro confiere un aire de sofisticación y profesionalismo. Es la elección ideal para el ambiente de oficina o reuniones importantes, ofreciendo una imagen elegante y atemporal.'
            },
            'pink': {
                title: 'Toque Casual y Vibrante',
                text: 'La opción rosado es más informal, pero con un encanto único. Es agradable a la vista y perfecta para el uso diario, la universidad o actividades al aire libre, reflejando una personalidad alegre.'
            }
        };

        function updateProductDetails(color) {
            const imagePaths = {
                'black': "{{ url_for('static', filename='images/ziloy_negro.png') }}",
                'pink': "{{ url_for('static', filename='images/ziloy_rosado.png') }}"
            };

            productImage.src = imagePaths[color];

            if (descriptionCard) {
                const desc = descriptions[color];
                descriptionCard.innerHTML = `
                    <h5>${desc.title}</h5>
                    <p>${desc.text}</p>
                `;
            }
        }

        blackBtn.addEventListener("click", () => updateProductDetails('black'));
        pinkBtn.addEventListener("click", () => updateProductDetails('pink'));

        document.addEventListener('DOMContentLoaded', () => {
            updateProductDetails('black');
        });

        const basePrice = 18;
        const priceEl = document.getElementById("price");
        const quantityInput = document.getElementById("quantity");
        const increaseBtn = document.getElementById("increaseBtn");
        const decreaseBtn = document.getElementById("decreaseBtn");

        function updatePrice() {
            const quantity = parseInt(quantityInput.value);
            const total = basePrice * quantity;
            priceEl.textContent = `USD $${total.toLocaleString("es-CO")}`;
        }

        increaseBtn.addEventListener("click", () => {
            let quantity = parseInt(quantityInput.value);
            quantity++;
            quantityInput.value = quantity;
            updatePrice();
        });

        decreaseBtn.addEventListener("click", () => {
            let quantity = parseInt(quantityInput.value);
            if (quantity > 1) {
                quantity--;
                quantityInput.value = quantity;
                updatePrice();
            }
        });

        // === ABRIR / CERRAR CHATBOT ===
        const chatbotPopup = document.getElementById('chatbotPopup');
        const openBotLink = document.getElementById('ziloyBotLink');
        const closeChatbot = document.getElementById('closeChatbot');

        if (openBotLink) {
            openBotLink.addEventListener('click', (e) => {
                e.preventDefault();
                chatbotPopup.style.display = 'flex';
            });
        }

        if (closeChatbot) {
            closeChatbot.addEventListener('click', () => {
                chatbotPopup.style.display = 'none';
            });
        }
    </script>

    <!-- === SCRIPT DE CONTROL DEL MODAL === -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btnComprar = document.querySelector('.product-details .btn');
            const overlay = document.getElementById('purchaseOverlay');
            const btnCancelar = document.getElementById('cancelPurchase');
            const btnConfirmar = document.getElementById('confirmPurchase');

            // Mostrar modal
            btnComprar.addEventListener('click', (e) => {
                e.preventDefault();
                overlay.classList.remove('hidden');
                document.body.classList.add('blurred');
            });

            // Ocultar modal
            btnCancelar.addEventListener('click', () => {
                overlay.classList.add('hidden');
                document.body.classList.remove('blurred');
            });

            // Enviar saludo al bot 
            if (btnConfirmar) {
                btnConfirmar.addEventListener('click', async () => {
                    try {
                        const response = await fetch("/enviar_mensaje_whatsapp", {
                            method: "POST"
                        });
                        if (response.ok) {
                            alert("Mensaje automático enviado al chatbot de WhatsApp.");
                        } else {
                            alert("Error al contactar con el bot");
                        }
                    } catch (err) {
                        console.error(err);
                    }
                    overlay.classList.add('hidden');
                    document.body.classList.remove('blurred');
                });
            }
        });
    </script>

    <script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>